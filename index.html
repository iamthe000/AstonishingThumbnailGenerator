<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>驚愕サムネジェネレーター</title>
    <style>
        @font-face {
            font-family: 'GenEiPopR';
            src: url('GenEiPOPle-Bk.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }

        #controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
        }

        #controls label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        #controls input[type="text"],
        #controls input[type="number"],
        #controls select {
            width: calc(100% - 20px);
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        #controls button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #controls button:hover {
            background-color: #0056b3;
        }

        #output {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        #previewCanvas {
            border: 1px solid #ccc;
            background-color: #eee;
            margin-bottom: 15px;
            max-width: 100%;
            height: auto;
        }

        #downloadLink {
            display: none; /* 初期は非表示 */
            margin-top: 15px;
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 16px;
        }

        #downloadLink:hover {
            background-color: #218838;
        }

        .color-option, .gradient-option, .shadow-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .color-option label, .gradient-option label, .shadow-option label {
            margin-right: 10px;
            margin-bottom: 0;
            flex-shrink: 0;
        }
        .color-option input[type="color"], .gradient-option input[type="color"], .shadow-option input[type="color"] {
            width: 40px;
            height: 40px;
            padding: 0;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>驚愕サムネジェネレーター</h1>

    <div id="controls">
        <label for="textInput">表示する文字:</label>
        <input type="text" id="textInput" value="世界が驚愕!!日本の最新技術がヤバすぎる!!">

        <label for="fontSize">フォントサイズ (px):</label>
        <input type="number" id="fontSize" value="80" min="10">

        <label for="fontFamily">フォント:</label>
        <select id="fontFamily">
            <option value="HGP創英角ポップ体, 'HGP Soei Kaku Poptai', 'GenEiPopR', sans-serif">HGP創英角ポップ体 (インストール済みの場合)</option>
            <option value="'GenEiPopR', sans-serif">源暎ぽっぷる (Webフォント)</option>
        </select>

        <label for="outlineWidth">縁取りの太さ (px):</label>
        <input type="number" id="outlineWidth" value="6" min="0">

        <div class="color-option">
            <label for="outlineColor">縁取りの色:</label>
            <input type="color" id="outlineColor" value="#ffffff">
        </div>

        <div class="gradient-option">
            <label for="gradientColor1">グラデーション上部色:</label>
            <input type="color" id="gradientColor1" value="#000000">
        </div>
        <div class="gradient-option">
            <label for="gradientColor2">グラデーション下部色:</label>
            <input type="color" id="gradientColor2" value="#ff0000">
        </div>

        <label for="gradientStop1">グラデーション上部停止位置 (0.0 - 1.0):</label>
        <input type="number" id="gradientStop1" value="0.0" min="0" max="1" step="0.05">

        <label for="gradientStop2">グラデーション下部停止位置 (0.0 - 1.0):</label>
        <input type="number" id="gradientStop2" value="1.0" min="0" max="1" step="0.05">

        <hr style="border: 0; height: 1px; background: #ddd; margin: 20px 0;">

        <h3>シャドウ設定</h3>
        
        <label for="shadowOffsetX">Xオフセット (px):</label>
        <input type="number" id="shadowOffsetX" value="0">

        <label for="shadowOffsetY">Yオフセット (px):</label>
        <input type="number" id="shadowOffsetY" value="10">

        <label for="shadowBlur">ぼかし (px):</label>
        <input type="number" id="shadowBlur" value="15" min="0">
        
        <div class="shadow-option">
            <label for="shadowColor">シャドウの色:</label>
            <input type="color" id="shadowColor" value="#000000">
        </div>

        <label for="shadowOpacity">シャドウの不透明度 (0.0 - 1.0):</label>
        <input type="number" id="shadowOpacity" value="1.0" min="0" max="1" step="0.05">

        <hr style="border: 0; height: 1px; background: #ddd; margin: 20px 0;">

        <button id="generateButton">PNGを生成</button>
    </div>

    <div id="output">
        <h2>プレビュー</h2>
        <canvas id="previewCanvas"></canvas>
        <a id="downloadLink" download="text_image.png">画像をダウンロード</a>
    </div>
    <footer>
        <a href="https://github.com/iamthe000/AstonishingThumbnailGenerator">このサイトはソースコードをGitHubで公開しています</a>
    </footer>

    <script>
        // DOM要素の取得
        const textInput = document.getElementById('textInput');
        const fontSizeInput = document.getElementById('fontSize');
        const fontFamilySelect = document.getElementById('fontFamily');
        const outlineWidthInput = document.getElementById('outlineWidth');
        const outlineColorInput = document.getElementById('outlineColor');
        const gradientColor1Input = document.getElementById('gradientColor1');
        const gradientColor2Input = document.getElementById('gradientColor2');
        const gradientStop1Input = document.getElementById('gradientStop1');
        const gradientStop2Input = document.getElementById('gradientStop2');
        const shadowOffsetXInput = document.getElementById('shadowOffsetX');
        const shadowOffsetYInput = document.getElementById('shadowOffsetY');
        const shadowBlurInput = document.getElementById('shadowBlur');
        const shadowColorInput = document.getElementById('shadowColor');
        const shadowOpacityInput = document.getElementById('shadowOpacity');
        const generateButton = document.getElementById('generateButton');
        const previewCanvas = document.getElementById('previewCanvas');
        const downloadLink = document.getElementById('downloadLink');
        const ctx = previewCanvas.getContext('2d');

        // HEXカラーコードをRGBA形式に変換するヘルパー関数
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.substring(1, 3), 16);
            const g = parseInt(hex.substring(3, 5), 16);
            const b = parseInt(hex.substring(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function drawText() {
            const text = textInput.value;
            const fontSize = parseInt(fontSizeInput.value);
            const fontFamily = fontFamilySelect.value;
            const outlineWidth = parseInt(outlineWidthInput.value);
            const outlineColor = outlineColorInput.value;
            const gradientColor1 = gradientColor1Input.value;
            const gradientColor2 = gradientColor2Input.value;
            const gradientStop1 = parseFloat(gradientStop1Input.value);
            const gradientStop2 = parseFloat(gradientStop2Input.value);
            const shadowOffsetX = parseInt(shadowOffsetXInput.value);
            const shadowOffsetY = parseInt(shadowOffsetYInput.value);
            const shadowBlur = parseInt(shadowBlurInput.value);
            const shadowHexColor = shadowColorInput.value;
            const shadowOpacity = parseFloat(shadowOpacityInput.value);

            // Canvasのサイズをテキストに合わせて調整（余裕を持たせる）
            ctx.font = `${fontSize}px ${fontFamily}`;
            const textMetrics = ctx.measureText(text);
            const textWidth = textMetrics.width;
            const textHeight = fontSize * 1.5;

            const padding = outlineWidth * 2 + Math.max(Math.abs(shadowOffsetX), Math.abs(shadowOffsetY)) + shadowBlur * 2 + 20;
            previewCanvas.width = textWidth + padding * 2;
            previewCanvas.height = textHeight + padding * 2;

            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // 描画の中心を計算
            const centerX = previewCanvas.width / 2;
            const centerY = previewCanvas.height / 2;

            // グラデーションの作成
            const gradient = ctx.createLinearGradient(0, centerY - fontSize / 2, 0, centerY + fontSize / 2);
            gradient.addColorStop(gradientStop1, gradientColor1);
            gradient.addColorStop(gradientStop2, gradientColor2);

            // 縁取りの設定
            ctx.strokeStyle = outlineColor;
            ctx.lineWidth = outlineWidth;
            ctx.lineJoin = 'round';
            ctx.miterLimit = 2;

            // 1. シャドウのみを先に描画する
            ctx.shadowColor = hexToRgba(shadowHexColor, shadowOpacity); 
            ctx.shadowOffsetX = shadowOffsetX;
            ctx.shadowOffsetY = shadowOffsetY;
            ctx.shadowBlur = shadowBlur;

            // シャドウを落とすために、一時的に黒で塗りつぶす
            ctx.fillStyle = 'black'; 
            ctx.fillText(text, centerX, centerY);
            
            // 2. シャドウをリセットする（以降の描画にはシャドウを適用しない）
            ctx.shadowColor = 'rgba(0,0,0,0)';
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.shadowBlur = 0;

            // 3. 縁取り（アウトライン）を描画
            ctx.strokeText(text, centerX, centerY);

            // 4. 塗りつぶし（グラデーション）を描画
            ctx.fillStyle = gradient;
            ctx.fillText(text, centerX, centerY);

            // PNGダウンロードリンクを更新
            downloadLink.href = previewCanvas.toDataURL('image/png');
            downloadLink.style.display = 'block';
        }

        // イベントリスナー
        textInput.addEventListener('input', drawText);
        fontSizeInput.addEventListener('change', drawText);
        fontFamilySelect.addEventListener('change', drawText);
        outlineWidthInput.addEventListener('change', drawText);
        outlineColorInput.addEventListener('input', drawText);
        gradientColor1Input.addEventListener('input', drawText);
        gradientColor2Input.addEventListener('input', drawText);
        gradientStop1Input.addEventListener('change', drawText);
        gradientStop2Input.addEventListener('change', drawText);
        shadowOffsetXInput.addEventListener('change', drawText);
        shadowOffsetYInput.addEventListener('change', drawText);
        shadowBlurInput.addEventListener('change', drawText);
        shadowColorInput.addEventListener('input', drawText);
        shadowOpacityInput.addEventListener('change', drawText);
        generateButton.addEventListener('click', drawText);

        // ページロード時に一度描画
        drawText();
    </script>
</body>
</html>
